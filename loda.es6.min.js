(()=>{var e,a={x:0,y:0},o={x:0,y:0},r=Math,t=r.pow,n=document,d=e=>r.min(200,r.max(-200,e)),c=(e,a,o)=>e.dispatchEvent(new CustomEvent(a,{detail:o})),i=()=>{var r={x:d(4*(o.x-a.x)),y:d(4*(o.y-a.y))},i={x:o.x+r.x,y:o.y+r.y,d:t(t(r.x,2)+t(r.y,2),.5)};c(n,"precursormove",{x:i.x,y:i.y,d:i.d}),(a=>{var o=n.elementFromPoint(a.x,a.y),r=[],t=[],d=e;if(!e||o&&o===e||(e.classList.remove("prehover"),c(e,"erphover")),o&&e!==o){for(;d;)t.push(d=d.parentNode);for(d=o;d;)r.push(d=d.parentNode);for(var i=0,l=t;i<l.length;i++)(d=l[i])&&r.indexOf(d)<0&&d.classList.remove("prehover");for(var g=0,p=r;g<p.length;g++)(d=p[g])&&d.classList&&t.indexOf(d)<0&&d.classList.add("prehover");o.classList.add("prehover"),c(o,"prehover",{d:a.d}),e=o}})(i),a=o};n.addEventListener("mousemove",e=>{o={x:e.clientX,y:e.clientY},i()})})(),console.log("Loda? ",window.Loda),window.Loda=!0;var changingHash,binderTimeout,cacheTimer,LODA_ID,LAST_PAGE,ignoreNav,queuedPage,deferredPageLoadSpooler,dispatchEventOnDocument=(e,a)=>{document.dispatchEvent(new CustomEvent(e,{detail:a}))},domLoaded=!1,loaded=!1,pageCache={},cachingPages={},loadedFor=[],SERVER="https://api.loda.rocks",USING_PROXY=!1,grab=e=>"string"==typeof e?document.getElementById(e):e,bind=(e,a,o)=>e.addEventListener(a,o),load=e=>bind(window,"DOMContentLoaded",e),loader=()=>{deferredPageLoadSpooler&&(clearTimeout(deferredPageLoadSpooler),deferredPageLoadSpooler=null),dispatchEventOnDocument("page-loading",{o:pageCache}),binderTimeout&&clearTimeout(binderTimeout),binderTimeout=setTimeout(actualLoader,10)},actualLoader=()=>{if(document.body){loaded&&(dispatchEventOnDocument("page-loaded"),[document,window].forEach(e=>{e.dispatchEvent(new UIEvent("load"))})),LAST_PAGE=location.href;var e=document.getElementsByTagName("a"),a=document.createElement("a"),o=location.hostname,r=location.href.indexOf("#");-1==r&&(r=location.href.length);for(var t=t=>{var n=e[t].href,d=n.indexOf("#");-1==d&&(d=n.length),e[t].href&&!e[t].getAttribute("loda-disabled")&&e[t].href.match(/^https?:\/\//)&&!e[t].getAttribute("target")&&(location.href.match(/^(.+?):\/\//)||[0])[1]==(n.match(/^(.+?):\/\//)||[0])[1]&&e[t].href.match(RegExp("^https?://"+o+"([:/#]|$)"))&&(n.substring(0,d)!=location.href.substring(0,r)?(e[t].addEventListener("prehover",()=>{startHover({target:e[t]})}),e[t].addEventListener("mousedown",clickLink),a.href=e[t].getAttribute("href"),e[t].setAttribute("loda-href","true")):e[t].addEventListener("click",ignoreNav))},n=0;n<e.length;n++)t(n);var d,c=grab("loda-script");if(c){d=c.getAttribute("loda-id"),LODA_ID=d;var i=c.getAttribute("loda-proxy");SERVER=i||"https://api.loda.rocks",USING_PROXY=!!i}("string"==typeof LODA_ID||USING_PROXY)&&loadedFor.indexOf(location.href)<0&&(pollServer(location.href,null),loadedFor.push(location.href)),dispatchEventOnDocument("page-prepped"),loaded=!0}else loader()};load(loader);var pollServer=(e,a)=>{var o=new XMLHttpRequest;o.addEventListener("load",()=>{var e=JSON.parse(o.response),a=e.pages;if(a)for(var r=0,t=a;r<t.length;r++){var n=t[r];cachePage(n)}else dispatchEventOnDocument("api-error",{error:e.t})});var r=document.createElement("a");r.href=e;var t={action:"loading_page",i:r.href,l:LODA_ID};a&&(r.href=a,t.g=r.href),o.open("POST",SERVER),o.send(JSON.stringify(t))},clickLink=e=>{var a;if("string"==typeof e)a=e;else{if(a=e.target,e.button)return;for(0===e.button&&e.preventDefault(),makeDeferredPageLoadSpooler();a&&!a.href;)a=a.parentNode;a=a.href}var o=LAST_PAGE;loadPage(a),"string"==typeof LODA_ID&&pollServer(a,o)},loadPage=(e,a)=>{LAST_PAGE=e,pageCache[e]?setTimeout(()=>{showPage(e,a)},0):cachePage(e,!0,a)};function makeDeferredPageLoadSpooler(){deferredPageLoadSpooler||(deferredPageLoadSpooler=setTimeout(()=>{var e=document.body;e.style.cursor="none",e.style.pointerEvents="none",e.style.opacity=".5"},500))}var startHover=e=>{for(var a=e.target;a&&"function"==typeof a.getAttribute&&!a.href;)a=a.parentNode;a&&"function"==typeof a.getAttribute&&(a=a.href,cacheTimer&&clearTimeout(cacheTimer),cacheTimer=setTimeout(()=>{cachePage(a)},0))},cachePage=(e,a,o)=>{if(a&&(queuedPage=e,dispatchEventOnDocument("page-queued",{page:e})),!cachingPages[e]){cachingPages[e]=!0;var r=storedPageFor(e);if(getSiteVersion()>-1&&r&&r.version>=getSiteVersion())pageCache[e]=r.content,dispatchEventOnDocument("permacache-hit",{page:e}),queuedPage&&showPage(e,o);else{var t=new XMLHttpRequest;t.addEventListener("load",()=>{pageCache[e]=t.response,dispatchEventOnDocument("page-cached",{page:e,content:t.content}),cleanCache(t.response.length),getSiteVersion()>-1&&getCacheSize()+t.response.length<4e6&&(localStorage.setItem(e,JSON.stringify({content:t.response,version:getSiteVersion(),p:+new Date,h:+new Date,s:"Loda"})),dispatchEventOnDocument("page-permacached")),queuedPage&&showPage(queuedPage,o)}),t.open("GET",e),t.send()}}},showPage=(e,a)=>{var o;e?(o=pageCache[e],window.document.open(),window.document.write(o),window.document.close(),a||history.pushState({page:e},null,e),setTimeout(()=>{loader()},0)):cachePage("index.html",!0,!0)},popPage=e=>{null===e.state&&changingHash?changingHash=!1:location.reload()};ignoreNav=()=>{changingHash=!0};var getSiteVersion=()=>{var e=grab("loda-script");return e&&e.getAttribute("site-version")||-1},storedPageFor=e=>{var a=localStorage.getItem(e);return a?JSON.parse(a):0},getCacheSize=()=>{for(var e=0,a=0,o=localStorage.length;a<o;++a){var r=localStorage.key(a),t=localStorage.getItem(r),n=void 0;try{n=JSON.parse(t)}catch(e){continue}"Loda"==n.s&&(e+=n.content.length)}return e},cleanCache=e=>{for(var a=getCacheSize();a+e>4e6&&a>0;){a=0;for(var o=+new Date,r=void 0,t=0,n=localStorage.length;t<n;++t){var d=localStorage.key(t),c=localStorage.getItem(d),i=void 0;try{i=JSON.parse(c)}catch(e){continue}"Loda"==i.s&&(a+=i.content.length,i.h<o&&(o=i.h,r=d))}r&&(localStorage.removeItem(r),dispatchEventOnDocument("pageCache-trimmed",{page:r}))}dispatchEventOnDocument("pageCache-cleaned")};bind(window,"DOMContentLoaded",()=>{domLoaded=!0});try{window.removeEventListener("popstate",popPage)}catch(e){console.log("popstate rebound")}window.addEventListener("popstate",popPage);
//# sourceMappingURL=loda.es6.min.js